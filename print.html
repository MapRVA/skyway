<!DOCTYPE HTML>
<html lang="en" class="light" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>skyway Documentation</title>
        <meta name="robots" content="noindex">


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body class="sidebar-visible no-js">
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('light')
            html.classList.add(theme);
            var body = document.querySelector('body');
            body.classList.remove('no-js')
            body.classList.add('js');
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var body = document.querySelector('body');
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            body.classList.remove('sidebar-visible');
            body.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="index.html">Introduction</a></li><li class="chapter-item expanded affix "><li class="part-title">Getting Started</li><li class="chapter-item expanded "><a href="installation.html"><strong aria-hidden="true">1.</strong> Installation</a></li><li class="chapter-item expanded "><a href="usage.html"><strong aria-hidden="true">2.</strong> Using skyway</a></li><li class="chapter-item expanded affix "><li class="part-title">Filtering</li><li class="chapter-item expanded "><a href="filtering.html"><strong aria-hidden="true">3.</strong> Using Filters</a></li><li class="chapter-item expanded "><a href="cel-filters.html"><strong aria-hidden="true">4.</strong> CEL Filters</a></li><li class="chapter-item expanded "><a href="osmfilter.html"><strong aria-hidden="true">5.</strong> OSMFilter</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">skyway Documentation</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/MapRVA/skyway" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="introduction"><a class="header" href="#introduction">Introduction</a></h1>
<p>skyway is a command-line OpenStreetMap file converter.</p>
<div class="warning">
skyway is currently in <a href="https://semver.org/">major version (0.y.z)</a>, i.e. it is undergoing initial development.
While I hope you find skyway helpful, it might not work as expected.
Your feedback and contributions are welcome. Thanks!
</div>
<h2 id="goals"><a class="header" href="#goals">Goals</a></h2>
<ul>
<li>Support a wide range of OpenStreetMap file formats</li>
<li>Provide a user-friendly tag filtering system, capable of scaling to planet-scale data</li>
<li><del>Be fast</del> <em>(currently focusing on adding features, performance will come later!)</em></li>
</ul>
<h2 id="alternatives"><a class="header" href="#alternatives">Alternatives</a></h2>
<p>Before adopting skyway for your project, please also consider <a href="https://osmcode.org/osmium-tool/">Osmium Tool</a>, a well-trusted and performant application that accomplishes many of the same things.</p>
<p>For a complete list of alternatives, please see the <a href="https://wiki.openstreetmap.org/wiki/OSM_file_formats">OSM file formats page</a> on the OpenStreetMap wiki.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="installation"><a class="header" href="#installation">Installation</a></h1>
<h2 id="pre-compiled-binaries"><a class="header" href="#pre-compiled-binaries">Pre-compiled Binaries</a></h2>
<p>Builds of skyway are available on the <a href="https://github.com/MapRVA/skyway/releases">releases page</a>.
Feel free to get in touch if you'd like me to prepare a binary for your platform.</p>
<h2 id="install-using-cargo"><a class="header" href="#install-using-cargo">Install Using Cargo</a></h2>
<p>skyway is <a href="https://crates.io/crates/skyway">on crates.io</a>, so you can install it using cargo:</p>
<pre><code class="language-sh">cargo install skyway
</code></pre>
<p>Make sure your cargo bin directory is in your $PATH.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="usage"><a class="header" href="#usage">Usage</a></h1>
<p>Here is an example of how to use skyway.
For more information, you can run <code>skyway --help</code>.</p>
<pre><code class="language-sh">skyway --from pbf --input input-file.pbf --to json --output output-file.json
</code></pre>
<p>If you do not specify an input or output file, skyway will default to standard in and standard out, respectively.
This enables you to stream data into and out of skyway, like this:</p>
<pre><code class="language-sh">cat input-file.pbf | skyway --from pbf --to json &gt; output-file.json
</code></pre>
<h2 id="supported-formats"><a class="header" href="#supported-formats">Supported Formats</a></h2>
<p>Here is a table showing the formats skyway supports reading and writing.
The shortname is used to indicate the format when running skyway, e.g. <code>skyway --from xml ...</code></p>
<p><strong>Key:</strong><br>
❌ – Not Supported<br>
✅ – Supported<br>
⚡ – Speedy!<br></p>
<div class="table-wrapper"><table><thead><tr><th>Format</th><th>Shortname</th><th>Reader</th><th>Writer</th></tr></thead><tbody>
<tr><td>GeoJSON</td><td></td><td>➖</td><td>❌</td></tr>
<tr><td>o5m</td><td></td><td>❌</td><td>❌</td></tr>
<tr><td>OPL</td><td><code>opl</code></td><td>✅</td><td>⚡</td></tr>
<tr><td>OSM Express</td><td></td><td>❌</td><td>❌</td></tr>
<tr><td>OSM JSON</td><td><code>json</code></td><td>✅</td><td>⚡</td></tr>
<tr><td>Overpass JSON</td><td>†</td><td>✅</td><td>⚡</td></tr>
<tr><td>OSM XML</td><td><code>xml</code></td><td>✅</td><td>✅</td></tr>
<tr><td>PBF</td><td><code>pbf</code></td><td>⚡</td><td>❌</td></tr>
</tbody></table>
</div>
<p><sup>†</sup><em>Use the shortname <code>json</code> to read OSM JSON, it is the same parser. Use <code>overpass</code> for writing.</em></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="filtering"><a class="header" href="#filtering">Filtering</a></h1>
<p>A skyway filter decides whether or not to keep an element, or possibly transforms it.
If you do not provide a filter to skyway, it will convert the original input as faithfully as it can.</p>
<h2 id="running-skyway-with-a-filter"><a class="header" href="#running-skyway-with-a-filter">Running skyway with a Filter</a></h2>
<p>To add a filter to skyway, add the <code>--filter [FILTER FILE]</code> option.
You may pass multiple filters to evaluate in sequence by passing multiple <code>--filter</code> flags.
The file extension does not matter; skyway will detect if the file is in CEL or OSMFilter and parse it accordingly.</p>
<h2 id="how-filters-work"><a class="header" href="#how-filters-work">How Filters Work</a></h2>
<p>In skyway, the input reader and output writer are run in different threads, with the former passing element objects to the latter as they become available.
This multithreaded approach makes it easy to add one or more middlemen, who can receive elements from the reader, transform them, and then pass them along down the chain.
skyway provides a "filtering" system to make it easier to add these processing steps in a modular way.
Using any number of CEL or OSMFilter expressions, you can create complex processing pipelines.</p>
<p>This system was inspired by <a href="https://pandoc.org/">Pandoc</a>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="cel-filters"><a class="header" href="#cel-filters">CEL Filters</a></h1>
<p>skyway supports the <a href="https://cel.dev/">Common Expression Language</a> (CEL) for filtering elements.
Each time the filter is evaluated for a given element, that expression's context (local variables) is updated to match the element's metadata.
For now, <strong>CEL filters may only return a boolean value</strong>, indicating whether or not the element should be kept.
Please <a href="https://github.com/MapRVA/skyway/issues">file an issue</a> if you'd like to see more complex CEL return types supported.</p>
<h2 id="cel-context"><a class="header" href="#cel-context">CEL Context</a></h2>
<p>The following table describes each variable available to your expression:</p>
<div class="table-wrapper"><table><thead><tr><th>Variable Name</th><th>CEL Type</th></tr></thead><tbody>
<tr><td><code>tags</code></td><td><code>map</code> with <code>string</code> keys and <code>string</code> values</td></tr>
<tr><td><code>changeset</code></td><td><code>int</code></td></tr>
<tr><td><code>user</code></td><td><code>string</code></td></tr>
<tr><td><code>uid</code></td><td><code>int</code></td></tr>
<tr><td><code>id</code></td><td><code>int</code></td></tr>
<tr><td><code>timestamp</code></td><td><code>string</code></td></tr>
<tr><td><code>visible</code></td><td><code>bool</code></td></tr>
<tr><td><code>type</code></td><td><code>string</code> ("node", "way", or "relation")</td></tr>
</tbody></table>
</div><div style="break-before: page; page-break-before: always;"></div><h1 id="osmfilter"><a class="header" href="#osmfilter">OSMFilter</a></h1>
<p>OSMFilter is a bespoke filtering language designed for skyway, allowing you to transform element data as they pass through skyway.</p>
<div class="warning">
This feature is intended to be the biggest value-add of skyway, but I haven't yet settled on a syntax that feels right.
I would <strong>massively appreciate</strong> your feedback!
How would your ideal filter language work?
</div>
<h2 id="specification"><a class="header" href="#specification">Specification</a></h2>
<p>An OSMFilter file must start with a header as shown below, with the version matching the version of skyway that you are using, <strong>followed by at least two newlines</strong>.
skyway will warn you if there is a version mismatch.
After the header, you can use any combination of <strong>selectors</strong> and <strong>modifiers</strong> to manipulate the elements.
Every selector must be followed by a <strong>tab-indented</strong> block of one or more modifiers or nested selectors.
Comments start with <code>#</code> and extend through the end of a line.</p>
<pre><code class="language-osmfilter">OSMFilter v0.2.0

TYPE way                                 # selects ways
	HAS "footway"                    # selects elements with a "footway" tag (any value)
		SET "surface" "concrete" # changes the value of the "surface" tag to be "concrete"
		COMMIT                   # immediately commit this element (skip the rest of the filter)
TYPE relation                            # selects relations
	EQUALS "type" "route"            # selects elements with the tag "type" set to "route"
		DROP                     # do not include element in output (skip the rest of the filter)
COMMIT                                   # commit the element
</code></pre>
<h2 id="statements"><a class="header" href="#statements">Statements</a></h2>
<p>Below you can find descriptions of each statement supported by OSMFilter.</p>
<h3 id="selectors"><a class="header" href="#selectors">Selectors</a></h3>
<p>A selector must be followed by one or more tab-indented statements (either a modifier or selection block).
You can nest selection blocks.</p>
<ul>
<li><code>TYPE way, node</code> — Selects elements of specified type(s), in a comma-separated list.</li>
<li><code>HAS "key"</code> — Selects elements with tag <code>key</code>.</li>
<li><code>EQUALS "key" "value"</code> — Selects elements with tag <code>key</code> equalling <code>value</code>.</li>
</ul>
<h3 id="modifiers"><a class="header" href="#modifiers">Modifiers</a></h3>
<ul>
<li><code>COMMIT</code> — Commits element as it currently is to be written to output. Short-circuits the rest of the filter for that element.</li>
<li><code>DROP</code> — Drops element, i.e. excluding it entirely from the output. Short-circuits the rest of the filter for that element.</li>
<li><code>SET "key" "value"</code> — Sets tag <code>key</code> to <code>value</code>.</li>
<li><code>KEEP "key_one", "key_two"</code> — Only keep tags with specified key(s), removing any others from the element.</li>
<li><code>RENAME "oldkey" "newkey"</code> — Renames tag <code>oldkey</code> to <code>newkey</code>, keeping the value of the tag the same.</li>
<li><code>DELETE "key_one", "key_two"</code> — Removes tag(s) with specified key(s) from the element.</li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->


                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">

            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->

        <script>
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>

    </div>
    </body>
</html>
